---
import Layout from '../layouts/Layout.astro';

// Mengambil semua file gambar jpg/jpeg di folder public/images
// import.meta.glob biasanya untuk src, tapi kita bisa akali dengan listing manual atau glob aset.
// Di Astro untuk public folder, kita tidak bisa pakai glob server-side standar untuk listing file public di build time dengan mudah tanpa fs.
// TAPI, kita bisa pakai fs (Node.js) karena ini SSG (Static Site Generation).

import fs from 'node:fs';
import path from 'node:path';

const imagesDir = path.join(process.cwd(), 'public/images');
let images = [];

try {
  const files = fs.readdirSync(imagesDir);
  images = files
    .filter(file => /\.(jpg|jpeg|png|webp)$/i.test(file)) // Hanya ambil gambar
    .filter(file => !file.startsWith('logo')) // Jangan masukkan logo ke galeri
    .filter(file => !file.startsWith('hero')) // Jangan masukkan hero
    .map(file => `/bambubos/images/${file}`); // Tambahkan prefix path
} catch (e) {
  console.error("Gagal membaca folder images", e);
}
---

<Layout title="Galeri Proyek BambuBos">
  <section class="bg-stone-900 text-white py-20 px-4 text-center">
    <h1 class="text-4xl md:text-6xl font-bold font-serif mb-4">Galeri Proyek</h1>
    <p class="text-xl text-stone-300 max-w-2xl mx-auto">Dokumentasi hasil pengerjaan Saung, Gazebo, dan Konstruksi Bambu kami.</p>
  </section>

  <section class="container mx-auto px-4 py-16">
    <!-- Grid Masonry-like -->
    <div class="columns-1 md:columns-2 lg:columns-3 gap-8 space-y-8">
      
      {images.map((img) => (
        <div class="break-inside-avoid rounded-xl overflow-hidden shadow-lg group bg-stone-100 mb-8 cursor-pointer">
          <img 
            src={img} 
            alt="Dokumentasi Proyek BambuBos" 
            class="gallery-img w-full h-auto hover:scale-105 transition duration-500" 
            loading="lazy"
            onerror="this.style.display='none'" 
          />
        </div>
      ))}

    </div>
  </section>

  <!-- Lightbox Modal (Zoom) -->
  <div id="lightbox" class="fixed inset-0 z-[100] bg-black/95 hidden items-center justify-center p-4 cursor-zoom-out transition-all duration-300 opacity-0">
      <img id="lightbox-img" src="" alt="Zoom Preview" class="max-h-[90vh] max-w-[95vw] object-contain rounded-lg shadow-2xl scale-95 transition-transform duration-300" />
      <button class="absolute top-6 right-6 text-white/80 hover:text-white text-5xl font-bold leading-none">&times;</button>
  </div>

  <script>
      const lightbox = document.getElementById('lightbox');
      const lightboxImg = document.getElementById('lightbox-img');
      const images = document.querySelectorAll('.gallery-img');

      // Buka Lightbox
      images.forEach(img => {
          img.addEventListener('click', (e) => {
              const src = e.target.getAttribute('src');
              if (lightbox && lightboxImg) {
                  lightboxImg.setAttribute('src', src);
                  lightbox.classList.remove('hidden');
                  // Timeout biar animasi fade-in jalan
                  setTimeout(() => {
                      lightbox.classList.remove('opacity-0');
                      lightboxImg.classList.remove('scale-95');
                  }, 10);
              }
          });
      });

      // Tutup Lightbox
      lightbox?.addEventListener('click', () => {
          lightbox.classList.add('opacity-0');
          lightboxImg?.classList.add('scale-95');
          setTimeout(() => {
              lightbox.classList.add('hidden');
          }, 300);
      });
  </script>
</Layout>